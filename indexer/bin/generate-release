#!/bin/bash
set -e
ARCHITECTURES="amd64 arm64 all"

file_line() {
  local algorithm="$1"
  local path="$2"
  echo " $(${algorithm}sum "$path" | cut -d' ' -f 1)   $(stat -c '%s  %n' "$path")"
}

lines_for_arch() {
  local algorithm="$1"
  local arch="$2"
  file_line $algorithm main/binary-$arch/Packages
  file_line $algorithm main/binary-$arch/Packages.gz
}

lines_for_algorithm() {
  local algorithm="$1"
  for arch in $ARCHITECTURES; do
    lines_for_arch $algorithm $arch
  done
}

# TODO: More metadata
echo "Date: $(date -R -u)"
echo "Architectures: $ARCHITECTURES"
echo "Components: main"
echo "Suite: stable"
echo "MD5Sum:"
lines_for_algorithm md5
echo "SHA1:"
lines_for_algorithm sha1
echo "SHA256:"
lines_for_algorithm sha256
